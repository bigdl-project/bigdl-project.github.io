<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../../img/favicon.ico">
  <title>Functional API - BigDL Project</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../../css/highlight.css">
  <link href="../../../extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Functional API";
    var mkdocs_page_input_path = "APIdocs/Model/Functional.md";
    var mkdocs_page_url = "/APIdocs/Model/Functional/";
  </script>
  
  <script src="../../../js/jquery-2.1.1.min.js"></script>
  <script src="../../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../../.." class="icon icon-home"> BigDL Project</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../../..">Overview</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../../release/">Releases</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../../getting-started/">Getting Started</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">User Guide</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../../UserGuide/install/">Install</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../UserGuide/run/">Run</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../UserGuide/examples/">Examples</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../UserGuide/resources/">More Resources</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Python Support</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../../PythonSupport/python-install/">Install</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../PythonSupport/python-run/">Run</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../PythonSupport/python-examples/">Examples</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../PythonSupport/python-resources/">More Examples and Tutorials</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../PythonSupport/tensorflow-support/">Tensorflow Support</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Programming Guide</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../scaladoc/">Scala Docs</a>
                </li>
                <li class="">
                    
    <a class="" href="../../python-api-doc/">Python API Docs</a>
                </li>
                <li class="">
                    
    <a class="" href="../../Data/merged-Data/">Data</a>
                </li>
                <li class=" current">
                    
    <span class="caption-text">Model</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../Sequential/">Sequential Model</a>
                </li>
                <li class="toctree-l3 current">
                    
    <a class="current" href="./">Functional API</a>
    <ul class="subnav">
            
    <li class="toctree-l4"><a href="#define-a-simple-model">Define a simple model</a></li>
    

    <li class="toctree-l4"><a href="#define-a-model-with-branches">Define a model with branches</a></li>
    

    <li class="toctree-l4"><a href="#define-a-model-with-merged-branch">Define a model with merged branch</a></li>
    

    <li class="toctree-l4"><a href="#define-a-model-with-multiple-inputs">Define a model with multiple inputs</a></li>
    

    </ul>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../ModuleAPI/">Module API</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Layers</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../Layers/Containers/merged-Containers/">Containers</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../Layers/Simple-Layers/merged-Simple-Layers/">Simple Layers</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../Layers/Convolution-Layers/merged-Convolution-Layers/">Convolution Layers</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../Layers/Pooling-Layers/merged-Pooling-Layers/">Pooling Layers</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../Layers/Linear-Layers/merged-Linear-Layers/">Linear Layers</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../Layers/Non-linear-Activations/merged-Non-linear-Activations/">Non-linear Activations</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../Layers/Embedding-Layers/merged-Embedding-Layers/">Embedding Layers</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../Layers/MergeSplit-Layers/merged-MergeSplit-Layers/">Merge/Split Layers</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../Layers/Math-Layers/merged-Math-Layers/">Math Layers</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../Layers/Padding-Layers/merged-Padding-Layers/">Padding Layers</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../Layers/Normalization-Layers/merged-Normalization-Layers/">Normalization Layers</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../Layers/Dropout-Layers/merged-Dropout-Layers/">Dropout Layers</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../Layers/Distance-Layers/merged-Distance-Layers/">Distance Layers</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../Layers/Recurrent-Layers/merged-Recurrent-Layers/">Recurrent Layers</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../Layers/Utilities/merged-Utilities/">Utilities</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../Losses/merged-Losses/">Losses</a>
                </li>
                <li class="">
                    
    <a class="" href="../../Initializers/merged-Initializers/">Initalizers</a>
                </li>
                <li class="">
                    
    <a class="" href="../../Regularizers/merged-Regularizers/">Regularizers</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Optimization</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../Optimizers/DistriOptimizer/">Optimizer</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../Optimizers/Optim-Methods/merged-Optim-Methods/">Optimization Algorithms</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../Optimizers/Triggers/">Triggers</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../Optimizers/ResumeTraining/">Resume Training</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../Metrics/merged-Metrics/">Metrics</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../ProgrammingGuide/visualization/">Visualization</a>
                </li>
                <li class="">
                    
    <a class="" href="../../MLPipeline/merged-MLPipeline/">MLPipeline</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../../powered-by/">Powered by</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../../known-issues/">Known Issues</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../..">BigDL Project</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../..">Latest Docs</a> &raquo;</li>
    
      
        
          <li>Programming Guide &raquo;</li>
        
      
        
          <li>Model &raquo;</li>
        
      
    
    <li>Functional API</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/intel-analytics/BigDL/"> Fork on GitHub </a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>BigDL supports two different model definition styles: Sequential API and Functional API.</p>
<p>In Functional API, the model is described as a graph. It is more convenient than Sequential API
when define some complex model.</p>
<h2 id="define-a-simple-model">Define a simple model</h2>
<p>Suppose we want to define a model with three layers</p>
<pre><code>Linear -&gt; Sigmoid -&gt; Softmax
</code></pre>

<p>You can write code like this</p>
<p><strong>Scala:</strong></p>
<pre><code class="scala">val linear = Linear(...).inputs()
val sigmoid = Sigmoid().inputs(linear)
val softmax = Softmax().inputs(sigmoid)
val model = Graph(Seq[linear], Seq[softmax])
</code></pre>

<p><strong>Python:</strong></p>
<pre><code class="python">linear = Linear(...)()
sigmoid = Sigmoid()(linear)
softmax = Softmax()(sigmoid)
model = Model([linear], [softmax])
</code></pre>

<p>An easy way to understand the Funtional API is to think of each layer in the model as a directed
edge connecting its input and output</p>
<p>In the above code, first we create an input node named as linear by using
the Linear layer, then connect it to the sigmoid node with a Sigmoid
layer, then connect the sigmoid node to the softmax node with a Softmax layer.</p>
<p>After defined the graph, we create the model by passing in the input nodes
and output nodes.</p>
<h2 id="define-a-model-with-branches">Define a model with branches</h2>
<p>Suppose we want to define a model like this</p>
<pre><code>Linear -&gt; ReLU --&gt; Linear -&gt; ReLU
               |-&gt; Linear -&gt; ReLU
</code></pre>

<p>The model has two outputs from two branches. The inputs of the branches are both the
output from the first ReLU.</p>
<p>You can define the model like this</p>
<p><strong>Scala:</strong></p>
<pre><code class="scala">val linear1 = Linear(...).inputs()
val relu1 = ReLU().inputs(linear1)
val linear2 = Linear(...).inputs(relu1)
val relu2 = ReLU().inputs(linear2)
val linear3 = Linear(...).inputs(relu1)
val relu3 = ReLU().inputs(linear3)
val model = Graph(Seq[linear1], Seq[relu2, relu3])
</code></pre>

<p><strong>Python:</strong></p>
<pre><code class="python">linear1 = Linear(...)()
relu1 = ReLU()(linear1)
linear2 = Linear(...)(relu1)
relu2 = ReLU()(linear2)
linear3 = Linear(...)(relu1)
relu3 = ReLU()(linear3)
model = Model(Seq[linear1], Seq[relu2, relu3])
</code></pre>

<p>In the above node, linear2 and linear3 are both from relu1 with separated
Linear layers, which construct the branch structure. When we create the model,
the outputs parameter contains relu2 and relu3 as the model has two outputs.</p>
<h2 id="define-a-model-with-merged-branch">Define a model with merged branch</h2>
<p>Suppose we want to define a model like this</p>
<pre><code>Linear -&gt; ReLU --&gt; Linear -&gt; ReLU ----&gt; Add
               |-&gt; Linear -&gt; ReLU --|
</code></pre>

<p>In the model, the outputs of the two branches are merged by an add operation.</p>
<p>You can define the model like this</p>
<p><strong>Scala:</strong></p>
<pre><code class="scala">val linear1 = Linear(...).inputs()
val relu1 = ReLU().inputs(linear1)
val linear2 = Linear(...).inputs(relu1)
val relu2 = ReLU().inputs(linear2)
val linear3 = Linear(...).inputs(relu1)
val relu3 = ReLU().inputs(linear3)
val add = CAddTable().inputs(relu2, relu3)
val model = Graph(Seq[linear1], Seq[add])
</code></pre>

<p><strong>Python:</strong></p>
<pre><code class="python">linear1 = Linear(...)()
relu1 = ReLU()(linear1)
linear2 = Linear(...)(relu1)
relu2 = ReLU()(linear2)
linear3 = Linear(...)(relu1)
relu3 = ReLU()(linear3)
add = CAddTable()(relu2, relu3)
model = Model(Seq[linear1], Seq[add])
</code></pre>

<p>In the above code, to merge the branch, we use the CAddTable, which takes two
input nodes, to generate one output node.</p>
<p>BigDL provides many merge layers. Please check Merge layers document page. They all
take a list of tensors as input and merge the tensors by some operation.</p>
<h2 id="define-a-model-with-multiple-inputs">Define a model with multiple inputs</h2>
<p>We have already seen how to define branches in model and how to merge branches.
What if we have multiple input? Suppose we want to define a model like this</p>
<pre><code>Linear -&gt; ReLU ----&gt; Add
Linear -&gt; ReLU --|
</code></pre>

<p>You can define the model like this</p>
<p><strong>Scala:</strong></p>
<pre><code class="scala">val linear1 = Linear(...).inputs()
val relu1 = ReLU().inputs(linear1)
val linear2 = Linear(...).inputs()
val relu2 = ReLU().inputs(linear2)
val add = CAddTable().inputs(relu1, relu2)
val model = Graph(Seq[linear1, linear2], Seq[add])
</code></pre>

<p><strong>Python:</strong></p>
<pre><code class="python">linear1 = Linear(...)()
relu1 = ReLU()(linear1)
linear2 = Linear(...)()
relu2 = ReLU()(linear2)
add = CAddTable()(relu1, relu2)
model = Model(Seq[linear1, linear2], Seq[add])
</code></pre>

<p>In the above code, we define two input nodes linear1 and linear2 and put them
into the first parameter when create the graph model.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../ModuleAPI/" class="btn btn-neutral float-right" title="Module API">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../Sequential/" class="btn btn-neutral" title="Sequential Model"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../Sequential/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../ModuleAPI/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../../js/theme.js"></script>

</body>
</html>
